#Copyright 2020-present Christos Tsotskas
#
#travisCI configuration, part of aristoptimiser, https://github.com/christos-tsotskas/aristoptimiser
#
#Licensed under the Apache License, Version 2.0 (the "License");
#you may not use this file except in compliance with the License.
#You may obtain a copy of the License at
#http://www.apache.org/licenses/LICENSE-2.0
#
#Unless required by applicable law or agreed to in writing, software
#distributed under the License is distributed on an "AS IS" BASIS,
#WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#
#Apache 2.0
#
#Leader author: Christos Tsotskas
#Created by christos at 11/04/2020




services:
  - docker
#
#addons:
#  sonarcloud:
#    organization: "christos-tsotskas"
#
#
#script:
#  # other script steps might be done before running the actual analysis
#  - sonar-scanner

language: python
os: linux
dist: bionic

python:
  - "3.6"      # current default Python on Travis CI

deploy:
  provider: heroku
  api_key:
    secure: $HEROKU_API_KEY

# command to install dependencies
install:
  - pip install pipenv
# command to run tests
script:
  - pipenv install
  - pipenv run pytest  --junit-xml=test-results/xunit2/results.xml -v test/test_configuration_of_optimiser.py
  - pipenv run coverage run aristoptimiser/OptimiserConfigurator.py
  - pipenv run coverage report -m
  - pipenv run coverage html
  - pipenv run coverage xml -i
  - pipenv run coverage xml -i -o test-results/coverage.xml
  - pipenv run codecov
#linting test
#- flake


after_success:
- sh .travis/deploy_dockerhub.sh


deploy:
- sh .travis/deploy_heroku.sh

after_deploy:
- heroku ps:scale web=1 -a aristoptimiser
- pipenv run pytest -v test/test_the_deployment_of_containers.py
- pipenv run pytest -v test/test_web_optimiser_configurator.py
- heroku ps:scale web=0 -a aristoptimiser

#after_success: "Testing Successful Deployment on Heroku"
#  - sh .travis/deploy_dockerhub.sh
#  - heroku ps:scale web=1 -a aristoptimiser
#  - pipenv run pytest -v test/test_the_deployment_of_containers.py
#  - heroku ps:scale web=0 -a aristoptimiser


